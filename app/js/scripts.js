class Model{constructor(){this.store={baseUrl:"https://app.rakuten.co.jp/services/api/BooksDVD/Search/20170404?format=json&booksGenreId=003&applicationId=1057232034750714217"}}set(s,t){this.store[s]=t}get(s){return this.store[s]}}
class View{constructor(t){this.model=t,this.form=document.getElementById("form"),this._init()}_init(){this.form.querySelector("#submit").addEventListener("click",t=>this.onSubmit(t));for(let t of this.form.querySelectorAll("input"))t.addEventListener("input",()=>{document.getElementById("submit").disabled=0===Array.from(this.form.querySelectorAll("input")).map(t=>t.value).filter(t=>""!==t).length})}buildSlider(t){t.Items.length?this.slider=new Slider("slider",t.Items):document.getElementById("slider").innerHTML='<div class="no-results">No results found. Please try again.'}setLoadingState(){document.getElementById("slider").innerHTML='<div class="no-results">Loading...</div>'}onSubmit(t){t.preventDefault();let e=this.form.querySelectorAll("input"),i="";for(const t of e)""!==t.value&&(i+=`&${t.name}=${t.value}`);this.model.set("requestString",i),window.dispatchEvent(new Event("reload data"))}}class Slider{constructor(t,e){this.data=e,this.element=t,this._init()}_init(){this.renderSlider(this.element,this.data),this.afterInit(),window.addEventListener("got data",this.createSlider)}afterInit(){document.getElementsByClassName("slide")[0].classList.add("visible"),document.getElementsByClassName("dot")[0].classList.add("active")}renderSlider(t,e){let i=document.getElementById(t);i.innerHTML="";let d=document.createElement("div");d.id="slider--inner",i.appendChild(d);for(const t of e){let e=t.Item,i=document.createElement("div");i.classList.add("slide");let n=`\n\t\t\t\t<div class="slide--left">\n\t\t\t\t\t<img src="${e.largeImageUrl}" alt="${e.title}" />\n\t\t\t\t</div>\n\t\t\t\t<div class="slide--right">\n\t\t\t\t\t<h1 class="slide--title">\n\t\t\t\t\t\t${e.title}\n\t\t\t\t\t</h1>\n\t\t\t\t\t<div class="slide--price">\n\t\t\t\t\t\t${e.itemPrice}å††\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="slide--caption">\n\t\t\t\t\t\t${e.itemCaption}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;i.innerHTML=n,d.appendChild(i)}let n=document.createElement("div");n.id="dots";for(var s=0;s<this.data.length;s++){this.data[s].Item;let t=s,e=document.createElement("div");e.classList.add("dot-container"),e.innerHTML=`<div class="dot" data-number="${s}"></div>`,e.addEventListener("click",()=>this.changeSlide(t)),n.appendChild(e)}let l=document.createElement("div");l.id="slider__bottom-bar";let a=document.createElement("button");a.id="slider__button--back",a.classList.add("btn","btn-dark"),a.innerText="<",a.addEventListener("click",()=>this.changeSlide("back"));let r=document.createElement("button");r.id="slider__button--forward",r.classList.add("btn","btn-dark"),r.innerText=">",r.addEventListener("click",()=>this.changeSlide("forward")),l.appendChild(a),l.appendChild(n),l.appendChild(r),i.appendChild(l)}changeSlide(t){let e,i=parseInt(document.querySelector(".dot.active").dataset.number);e="forward"===t?i+1==this.data.length?0:i+1:"back"===t?i-1<0?this.data.length-1:i-1:parseInt(t),document.querySelector(".dot.active").classList.remove("active"),document.querySelector(".slide.visible").classList.remove("visible"),document.getElementsByClassName("dot")[e].classList.add("active"),document.getElementsByClassName("slide")[e].classList.add("visible")}}
class Controller{constructor(t,e){this.model=t,this.view=e,this._init()}_init(){window.addEventListener("reload data",()=>{this.getData(this.model.get("baseUrl")+this.model.get("requestString"))})}getData(t){this.view.setLoadingState(),fetch(t).then(t=>{200===t.status?t.json().then(t=>{this.view.buildSlider(t)}):console.log("There was a problem. Status: "+response.status)}).catch(t=>{console.log("There was an error retrieving the data:",t)})}}
function _init(){let e=new Model,n=new View(e);new Controller(e,n)}window.addEventListener("DOMContentLoaded",e=>{console.log("DOM loaded"),_init()});